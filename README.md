Snow Scraper

Snow Scraper is a Raspberry Pi based project that scrapes live snowfall
reports from major ski resorts, displays the data on a touchscreen LCD,
and triggers visual and audio alerts when a powder day arrives.

It is built for the Raspberry Pi Zero 2 W (Python 3.9) and integrates a
WS2812 RGB LED ring, passive buzzer, and ILI9341 touchscreen display.

-----------------------------------------------------------------------

Features

- Real-time snow data
  Scrapes snowfall reports (24hr, 7-day, base depth) for supported resorts.

- Avalanche forecast views
  Pulls avalanche.ca point forecasts using resort lat/lon, with a
  text-first view and a colored risk mask overlay.

- Touchscreen GUI
  320x240 ILI9341 LCD with resistive touch controls for reports, settings,
  WiFi config, and updates.

- Brightness profiles
  One-tap dimming that applies to the LCD (overlay) and LED brightness,
  persisted in conf/brightness.conf.

- Powder day alerts
  Passive buzzer melody and LED ring effects when snowfall thresholds hit.

- Snow LEDs
  7-pixel WS2812 ring shows snowfall with gradients, breathing on change,
  sparkles for heavy snow, and startup rainbow.

- Alarm modes
  Time-based alarm plus incremental "always-on" alarms (example: every +5 cm).

- On-device touch calibration
  Built-in 4-point calibration if no calibration file is present.

- WiFi setup screen
  Edits /etc/wpa_supplicant/wpa_supplicant.conf and triggers reconfigure.

- Robust logging
  Logs to logs/snowgui.log with rotation and console fallback.

- SD wear reduction
  Tries to enforce volatile journald storage (RAM only) on systemd systems.

-----------------------------------------------------------------------

Hardware Requirements

- Raspberry Pi Zero 2 W (tested)
- ILI9341 SPI LCD (320x240) with XPT2046 touch controller
- WS2812 RGB LED ring (7 pixels)
- Passive buzzer (wired to GPIO18)
- WiFi connection for fetching resort data

-----------------------------------------------------------------------

Software Requirements

- Raspberry Pi OS (32-bit Lite recommended)
- Python 3.9
- Required libraries:

  sudo apt update
  sudo apt install python3-pip git python3-psutil
  sudo apt install libjpeg62-turbo-dev zlib1g-dev libopenjp2-7 libtiff5 libfreetype6-dev
  sudo pip3 install python-daemon requests beautifulsoup4 luma.lcd RPi.GPIO packaging pillow spidev rpi_ws281x

-----------------------------------------------------------------------

Installation

Clone the repository:

  git clone https://github.com/spellbin/snowscraper.git
  cd snowscraper

(Optional) run the standalone touch calibrator:

  sudo python3 calibrate_touchscreen.py

-----------------------------------------------------------------------

Usage

Start the main GUI:

  python3 snowgui.py

Run with watchdog daemon (recommended):

  sudo chmod +x setup_service.sh
  sudo ./setup_service.sh

-----------------------------------------------------------------------

Configuration Files

- conf/skihill.conf
  Stores selected resort index.

- conf/alarm.conf
  Stores alarm settings and thresholds.

- conf/brightness.conf
  Stores the brightness profile index (applies to LCD + LEDs).

- conf/touch_calibration.json
  Generated by calibration workflow.

- conf/resorts_meta.yaml
  Resort metadata (lat/lon, region) used for avalanche forecasts.

- logs/snow_log.json
  Rolling daily snowfall logs per resort.

- logs/snowgui.log
  Rotating application log.

- heartbeat.txt
  Updated by snowgui.py; symlinked to /run/heartbeat.txt for watchdogs.

-----------------------------------------------------------------------

LED Demo Mode

Run the LEDs without fetching live snow data:

  python3 snowgui.py --led-demo
  python3 snowgui.py --led-demo "0,2,5,10,15,20,0"

You can also set SNOWGUI_LED_DEMO=1 in the environment.

-----------------------------------------------------------------------

Project Structure

  .
  |-- snowgui.py               # Main GUI + scraper
  |-- setup_service.sh         # Create a systemd service for autoboot
  |-- calibrate_touchscreen.py # Standalone calibration tool
  |-- conf/                    # Config + calibration data
  |-- logs/                    # Log output
  |-- images/                  # UI image assets (mainmenu.png, splashlogo.png, etc.)

-----------------------------------------------------------------------

Updating

The Update screen checks GitHub releases. On systemd systems, updates run
in a transient systemd unit to safely stop/start the GUI service.

To manually update:

  git fetch --all --tags
  git checkout tags/<version>
